[
  {
    "name": "apiary-hms-readonly",
    "image": "${hms_docker_image}:${hms_docker_version}",
    ${docker_auth}
    "essential": true,
    "ulimits": [
      {
        "softLimit": ${nofile_ulimit},
        "hardLimit": ${nofile_ulimit},
        "name": "nofile"
      }
    ],
    "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
            "awslogs-group": "${loggroup}",
            "awslogs-region": "${region}",
            "awslogs-stream-prefix": "/"
        }
    },
  "dockerLabels": {
    "com.datadoghq.ad.instances": "[{ \"openmetrics_endpoint\": \"http://%%host%%:8080/actuator/prometheus\", \"namespace\": \"hms_readonly_legacy\", \"metrics\": [\"metrics_classloading_loaded_value\"], \"type_overrides\": { \"metrics_classloading_loaded_value\": \"gauge\"}  }]",
    "com.datadoghq.ad.check_names": "[\"openmetrics\"]",
    "com.datadoghq.ad.init_configs": "[{}]"
  },
    "portMappings": [
      {
        "containerPort": 9083,
        "hostPort": 9083
      }
    ],
    "environment":[
     {
        "name": "MYSQL_DB_HOST",
        "value": "${mysql_db_host}"
     },
     {
        "name": "MYSQL_DB_NAME",
        "value": "${mysql_db_name}"
     },
     {
        "name": "MYSQL_SECRET_ARN",
        "value": "${mysql_secret_arn}"
     },
     {
        "name": "HADOOP_HEAPSIZE",
        "value": "${hms_heapsize}"
     },
     {
        "name": "AWS_REGION",
        "value": "${region}"
     },
     {
        "name": "HIVE_DB_WHITELIST",
        "value": "${shared_schemas}"
     },
     {
        "name": "INSTANCE_NAME",
        "value": "${instance_name}"
     },
     {
        "name": "HIVE_METASTORE_LOG_LEVEL",
        "value": "${hive_metastore_log_level}"
     },
     {
        "name": "ENABLE_METRICS",
        "value": "${enable_metrics}"
     }
    ]
  },
  {
    "name": "datadog-agent",
    "image": "public.ecr.aws/datadog/agent:7.46.0-jmx",
    "essential": true,
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${loggroup}",
        "awslogs-region": "${region}",
        "awslogs-stream-prefix": "/"
      }
    },
    "environment": [
      {
        "name": "DD_API_KEY",
        "value": "${datadog_secret_key}"
      },
      {
        "name": "ECS_FARGATE",
        "value": "true"
      }
    ]
  }
]
